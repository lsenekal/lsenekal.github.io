<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chat</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
    theme: {
        extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
                'gemini-blue': '#10a37f',
                'gemini-gray': '#f7f7f8',
                'gemini-dark': '#111827',
                'gemini-msg': '#e5e7eb',
                'gemini-user': '#0ea5e9'
            }
        }
    }
}
</script>
<style>
html, body { scroll-behavior: smooth; }
.chat-area::-webkit-scrollbar { width: 6px; }
.chat-area::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
.chat-area { scrollbar-width: thin; scrollbar-color: #cbd5e1 transparent; }

.message-content b { font-weight: 700; }
.message-content br { white-space: pre; }
.message-content ul { padding-left: 1.2rem; list-style: disc; margin: 0.5rem 0; }
.message-content li { margin: 0.25rem 0; }
</style>
</head>
<body class="bg-gemini-gray flex items-center justify-center min-h-screen p-4 font-sans">

<div id="chat-container" class="w-full max-w-2xl h-[90vh] flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden">

    <!-- Header -->
    <header class="p-4 bg-gemini-dark text-white shadow-md flex items-center">
        <h1 class="text-xl font-bold">AI Chat</h1>
        <div class="ml-auto flex items-center space-x-2">
            <label for="model-select" class="text-sm text-white">Model:</label>
            <select id="model-select" class="rounded-md p-1 text-black">
                <option value="gemma-3-27b-it">Gemma</option>
                <option value="gemini-2.5-flash">Gemini Flash</option>
            </select>
        </div>
    </header>

    <!-- Messages -->
    <div id="messages" class="chat-area flex-1 overflow-y-auto p-4 space-y-4 bg-gemini-gray">
        <div class="flex justify-start">
            <div class="bg-gemini-msg text-gemini-dark p-4 rounded-xl max-w-md shadow message-content">
                Hi there! ðŸ‘‹ Ask me anything.
            </div>
        </div>
    </div>

    <!-- Input -->
    <form id="chat-form" class="p-4 border-t border-gray-300 flex items-center bg-white">
        <input type="text" id="user-input" placeholder="Type your message..."
               class="flex-1 p-3 border border-gray-300 rounded-l-full focus:ring-2 focus:ring-gemini-user focus:border-gemini-user transition duration-150 shadow-inner"
               autocomplete="off" required>
        <button type="submit" id="send-button"
                class="bg-gemini-user hover:bg-teal-600 text-white font-semibold py-3 px-6 rounded-r-full transition duration-150 flex items-center justify-center disabled:opacity-50 ml-2">
            <span id="button-text">Send</span>
            <div id="loader" class="hidden w-5 h-5 border-2 border-white border-t-2 border-t-gemini-blue rounded-full animate-spin ml-2"></div>
        </button>
    </form>
</div>

<script>
const apiKey = "AIzaSyB9szLkUYPkTcyim4eK78xYOdhkVsmerSk";
const chatForm = document.getElementById('chat-form');
const userInput = document.getElementById('user-input');
const messagesContainer = document.getElementById('messages');
const sendButton = document.getElementById('send-button');
const loader = document.getElementById('loader');
const modelSelect = document.getElementById('model-select');

let chatHistory = [];

// Format message text for bold, bullets, line breaks
function formatMessage(text) {
    // Bold **text**
    text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
    // Bullets starting with *
    text = text.replace(/^\s*\* (.+)$/gm, '<li>$1</li>');
    text = text.replace(/(<li>.*?<\/li>)/gs, '<ul>$1</ul>');
    // Newlines with ###
    text = text.replace(/###/g, '<br>');
    return text;
}

// Append message to chat
function appendMessage(text, sender) {
    const messageEl = document.createElement('div');
    messageEl.classList.add('flex', 'items-end', sender === 'user' ? 'justify-end' : 'justify-start');

    const contentEl = document.createElement('div');
    contentEl.className = `p-4 rounded-xl max-w-md shadow break-words message-content ${
        sender === 'user' ? 'bg-gemini-user text-white rounded-br-none' : 'bg-gemini-msg text-gemini-dark rounded-tl-none'
    }`;

    const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const modelLabel = sender === 'model' ? ` <span class="text-xs text-gray-500 ml-2">(${modelSelect.options[modelSelect.selectedIndex].text})</span>` : '';
    contentEl.innerHTML = formatMessage(text) + `<div class="text-xs text-gray-500 mt-1 text-right">${timestamp}${modelLabel}</div>`;

    messageEl.appendChild(contentEl);
    messagesContainer.appendChild(messageEl);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Get API URL based on selected model
function getApiUrl() {
    const selectedModel = modelSelect.value;
    if (selectedModel === "gemma-3-27b-it") {
        return `https://generativelanguage.googleapis.com/v1beta/models/gemma-3-27b-it:generateContent?key=${apiKey}`;
    } else if (selectedModel === "gemini-2.5-flash") {
        return `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
    }
}

// Handle message submit
chatForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const prompt = userInput.value.trim();
    if (!prompt) return;

    appendMessage(prompt, 'user');
    userInput.value = '';
    sendButton.disabled = true;
    loader.classList.remove('hidden');
    document.getElementById('button-text').textContent = 'Thinking...';
    userInput.placeholder = 'Waiting for response...';

    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
    const payload = { contents: [{ parts: [{ text: prompt }] }] };

    try {
        const response = await fetch(getApiUrl(), {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error(`API returned status ${response.status}`);
        const result = await response.json();

        const modelResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, no response.";
        chatHistory.push({ role: "model", parts: [{ text: modelResponse }] });
        appendMessage(modelResponse, 'model');

    } catch (error) {
        console.error("API call failed:", error);
        appendMessage(`Connection Error: ${error.message}`, 'model');
    } finally {
        sendButton.disabled = false;
        loader.classList.add('hidden');
        document.getElementById('button-text').textContent = 'Send';
        userInput.placeholder = 'Type your message...';
        userInput.focus();
    }
});
</script>

</body>
</html>
